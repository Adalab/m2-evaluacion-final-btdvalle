"use strict";const btn=document.querySelector(".js-btn"),btnDelete=document.querySelector(".js-delete-all");let series=[],favorites=[];const searchInServer=function(e){e.preventDefault();const t=document.querySelector(".js-input").value;series=[],fetch(`http://api.tvmaze.com/search/shows?q=${t}`).then(e=>e.json()).then(e=>{console.log(e),formatAndSafeDataInSeries(e),printSeries(),listenClickAtList()})},formatAndSafeDataInSeries=function(e){for(const t of e)series.push({name:t.show.name,img:hasImage(t)})},hasImage=function(e){return null===e.show.image?`https://via.placeholder.com/210x295/ffffff/666666/?text=${e.show.name}`:e.show.image.medium},printSeries=function(){const e=document.querySelector(".js-ul-series");let t="";for(let e=0;e<series.length;e++)t+=`<li class= "list-item ${getFavoriteClass(e)}" data-index="${e}">`,t+=`<div class="img-container" data-index="${e}">`,t+=`<img class="img" src="${series[e].img}" />`,t+="</div>",t+=`<h2 class="serie-title">${series[e].name}</h2>`,t+="</li>";e.innerHTML=t},listenClickAtList=function(){const e=document.querySelectorAll(".ul-series .list-item");for(const t of e)t.addEventListener("click",whenClick)},clickAtList=function(e){const t=e.currentTarget.dataset.index;return parseInt(t)},whenClick=function(e){const t=clickAtList(e);isInFavorites(t)?removeFromFavorites(t):addToFavorites(t),printFavorites(),applyXbtn(),setSeriesIntoLocalStorage(),printSeries(),listenClickAtList()},isInFavorites=function(e){if(favorites.length>0){const t=series[e].name;for(let e=0;e<favorites.length;e++)if(t===favorites[e].name)return!0}return!1},addToFavorites=function(e){favorites.push({name:series[e].name,img:series[e].img,index:e}),console.log(favorites)},removeFromFavorites=function(e){const t=series[e].name;for(let e=0;e<favorites.length;e++)t===favorites[e].name&&favorites.splice(e,1)},removeFromFavoritesWithBtn=function(e){const t=e.currentTarget.parentElement.dataset.index,s=parseInt(t);favorites.splice(s,1),console.log(favorites),printFavorites(),applyXbtn(),setSeriesIntoLocalStorage()},removeClass=function(){document.querySelectorAll(".ul-series .list-item").classList.remove("favorite")},getFavoriteClass=function(e){return isInFavorites(e)?"favorite":""},printFavorites=function(){const e=document.querySelector(".js-ul-fav");e.innerHTML="";for(let t=0;t<favorites.length;t++){let s="";console.log("paso por aquÃ­"),s+=`<li class= "list-item favorite" data-index="${t}">`,s+='<div class="img-container">',s+=`<img class="img" src="${favorites[t].img}" />`,s+="</div>",s+=`<h2 class="serie-title">${favorites[t].name}</h2>`,s+='<div class= "x"><strong>x</strong></div>',s+="</li>",e.innerHTML+=s}favorites.length>1?btnDelete.classList.remove("hidden"):favorites.length<2&&btnDelete.classList.add("hidden")},setSeriesIntoLocalStorage=()=>{localStorage.setItem("favorites",JSON.stringify(favorites))},getSeriesFromLocalStorage=()=>{const e=JSON.parse(localStorage.getItem("favorites"));!0==!!e&&(favorites=e)},startApp=function(){getSeriesFromLocalStorage(),!0==!!favorites&&printFavorites()},listenXbtn=function(){const e=document.querySelectorAll(".x");for(const t of e)t.addEventListener("click",removeFromFavoritesWithBtn)},applyXbtn=function(){!0==!!favorites&&(printFavorites(),listenXbtn())},collapsibleTriggers=document.querySelectorAll(".js-collapsible-trigger");function updateCollapsible(e){const t=e.currentTarget.parentElement;if(t.classList.contains("js-collapsible-open"))t.classList.remove("js-collapsible-open");else{for(const e of collapsibleTriggers)e.parentElement.classList.remove("js-collapsible-open");t.classList.add("js-collapsible-open")}}for(const e of collapsibleTriggers)e.addEventListener("click",updateCollapsible);const deleteAll=function(){favorites=[],printFavorites()};btn.addEventListener("click",searchInServer),btnDelete.addEventListener("click",deleteAll),getSeriesFromLocalStorage(),1==!!favorites&&printFavorites(),applyXbtn();